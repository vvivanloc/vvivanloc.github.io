!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,n){var i,o;i=[n,t],void 0!==(o=function(e,t){"use strict";return new(function(){function e(){this.assetPath="assets"}return e}())}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o;i=[n,t],void 0!==(o=function(e,t){"use strict";t.__esModule=!0;var n=function(){function e(t){this.type=e.typeID,this.objectName=t}return e}();n.typeID="teleported",t.EventTeleported=n;var i=function(){function e(){this.type=e.typeID}return e}();i.typeID="allItemsOut",t.EventAllHidden=i}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o;i=[n,t],void 0!==(o=function(e,t){"use strict";function n(e){return new Promise(function(t,n){(new THREE.JSONLoader).load(e,function(e,i){e||n("Mesh empty");var o;o=i?new THREE.MultiMaterial(i):new THREE.MeshPhongMaterial({color:8947848});var s=new THREE.Mesh(e,o);s.castShadow=!0,t(s)},function(e){},function(e){n(e.error)})})}t.__esModule=!0,t.loadModel=n}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o;i=[n,t,n(0),n(12),n(1),n(8),n(10),n(11)],void 0!==(o=function(e,t,n,i,o,s,r,a){"use strict";return function(){function e(e,t){var n=this;this.onMouseMove=function(e){e.preventDefault(),n.mMarker.move(n.mouseWindowToPercentagePos(new THREE.Vector2(e.clientX,e.clientY)),!0)},this.onTouchMove=function(e){var t=e.changedTouches;t.length>0&&n.mMarker.move(n.touchWindowToPercentagePos(new THREE.Vector2(t[0].clientX,t[0].clientY)),!1)},this.onMouseDown=function(e){e.preventDefault(),n.mMarker.put(n.mouseWindowToPercentagePos(new THREE.Vector2(e.clientX,e.clientY)))},this.onTouchDown=function(e){var t=e.changedTouches;t.length>0&&n.mMarker.put(n.touchWindowToPercentagePos(new THREE.Vector2(t[0].clientX,t[0].clientY)))},this.onMouseUp=function(e){e.preventDefault(),n.mMarker.remove(n.mouseWindowToPercentagePos(new THREE.Vector2(e.clientX,e.clientY)),!0)},this.onTouchUp=function(e){var t=e.changedTouches;t.length>0&&n.mMarker.remove(n.touchWindowToPercentagePos(new THREE.Vector2(t[0].clientX,t[0].clientY)),!1)},this.onMouseOver=function(){n.mDOMContainerIsHovered=!0},this.onWindowResize=function(){if(!n.mDOMContainer)return void console.error("invalid contained");n.mCamera.aspect=n.mDOMContainer.clientWidth/n.mDOMContainer.clientHeight,n.mCamera.updateProjectionMatrix(),n.mRenderer.setSize(n.mDOMContainer.clientWidth,n.mDOMContainer.clientHeight),n.mPortalView&&n.mPortalView.moveToWindowPlane(n.mCamera)},this.animate=function(){if(!n.mDOMContainer)return void console.error("No DOM container!");setTimeout(function(){requestAnimationFrame(n.animate),n.mPortalView&&n.mPortalView.updateAnimation(),n.enablePhysics&&n.updatePhysics(),n.render()},1e3/n.mFps)},this.mSceneObjects=new i({mass:2,startHeight:7,objectHeight:2}),this.enablePhysics=!0,this.buildCannonWorld(),this.buildThreeJsScene(e,t),this.mSceneObjects.addEventListener(o.EventAllHidden.typeID,function(){setTimeout(n.resetSimulation(),1e3)}),this.mDOMContainerIsHovered=!1,this.mFps=60,navigator.userAgent.indexOf("Firefox")>0&&(this.mFps=60),this.mPhysicsDeltaTime=1/this.mFps,this.onWindowResize()}return e.prototype.addPortal=function(e,t){var n=this;this.mPortalView=new a(e,t),this.mPortalView.load(this.mScene,function(){n.onWindowResize()})},e.prototype.getSceneObjects=function(){return this.mSceneObjects},e.prototype.buildCannonWorld=function(){this.mWorld=new CANNON.World,this.mWorld.quatNormalizeSkip=0,this.mWorld.quatNormalizeFast=!1,this.mWorld.gravity.set(0,-9.8,0),this.mWorld.broadphase=new CANNON.NaiveBroadphase;var e=new CANNON.Plane,t=new CANNON.Body({mass:0});t.addShape(e),t.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0),-Math.PI/2),this.mWorld.addBody(t)},e.prototype.buildThreeJsScene=function(e,t){var n=this;if(this.mDOMContainer=document.getElementById(e),!this.mDOMContainer)return void console.error("No DOM element with ID="+e);this.mScene=new THREE.Scene,this.mScene.fog=new THREE.Fog(0,500,1e4),this.mCamera=new THREE.PerspectiveCamera(30,this.mDOMContainer.clientWidth/this.mDOMContainer.clientHeight,.5,1e4),this.mCamera.position.set(15,2,0),this.mCamera.quaternion.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2),this.mScene.add(this.mCamera);var i;this.mScene.add(new THREE.AmbientLight(6710886)),i=new THREE.DirectionalLight(11184827,1.75);i.position.set(20,20,20),i.castShadow=!0,i.shadow.camera.visible=!0,i.shadow.mapSize.width=1024,i.shadow.mapSize.height=1024,this.mScene.add(i);var o=new THREE.PlaneGeometry(100,100,1,1),r=new THREE.MeshLambertMaterial({color:7829367}),a=new THREE.Mesh(o,r);a.name="ground",a.castShadow=!0,a.position.setZ(3),a.quaternion.setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2),a.receiveShadow=!0,this.mScene.add(a),this.mRenderer=t?new THREE.WebGLRenderer({antialias:!0,canvas:t}):new THREE.WebGLRenderer({antialias:!0}),this.mRenderer.setSize(this.mDOMContainer.clientWidth,this.mDOMContainer.clientHeight),this.mRenderer.setClearColor(new THREE.Color("#fff")),this.mDOMContainer.appendChild(this.mRenderer.domElement),this.mRenderer.gammaInput=!0,this.mRenderer.gammaOutput=!0,this.mRenderer.shadowMap.enabled=!0,this.mMarker=new s(this.mScene,this.mCamera,this.mWorld,this.mSceneObjects);var h;window.addEventListener("resize",function(){h&&clearTimeout(h),h=setTimeout(function(){console.log("resize canvas"),n.onWindowResize(),h=null},250)},!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("touchmove",this.onTouchMove,!1),window.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("touchstart",this.onTouchDown,!1),window.addEventListener("mouseup",this.onMouseUp,!1),window.addEventListener("touchend",this.onTouchUp,!1),this.mDOMContainer.addEventListener("mouseover",this.onMouseOver)},e.prototype.addLoadedModels=function(e){for(var t=new r(this.mScene,this.mWorld,this.mSceneObjects),i=0,o=e;i<o.length;i++){var s=o[i];t.load(n.assetPath,s)}},e.prototype.addCubes=function(e){void 0===e&&(e=3);for(var t=new CANNON.Box(new CANNON.Vec3(.5,.5,.5)),n=new THREE.BoxGeometry(1,1,1,2,2),i=new THREE.MeshPhongMaterial({color:8947848}),o=0;o<e;o++){var s=new CANNON.Body({mass:5});s.addShape(t),s.position.set(0,5*o+5,0),this.mWorld.addBody(s);var r=new THREE.Mesh(n,i);r.castShadow=!0,r.name="cube_"+o.toString(),this.mScene.add(r),this.mSceneObjects.push(r,s)}},e.prototype.clear=function(){for(var e=0;e!==this.mSceneObjects.mMeshes.length;e++)this.mWorld.remove(this.mSceneObjects.mBodies[e]),this.mScene.remove(this.mSceneObjects.mMeshes[e]);this.mSceneObjects.mMeshes=[],this.mSceneObjects.mBodies=[],this.mSceneObjects.mStates=[]},e.prototype.touchWindowToPercentagePos=function(e){var t=this.mDOMContainer.getBoundingClientRect();return new THREE.Vector2((e.x-t.left)/this.mDOMContainer.clientWidth,(e.y-t.top)/this.mDOMContainer.clientHeight)},e.prototype.mouseWindowToPercentagePos=function(e){var t=this.mDOMContainer.getBoundingClientRect();return new THREE.Vector2((e.x-t.left)/this.mDOMContainer.clientWidth,(e.y-t.top)/this.mDOMContainer.clientHeight)},e.prototype.updateDOMContainer=function(e){this.mDOMContainer&&this.mDOMContainer.removeEventListener("mouseover",this.onMouseOver),this.mDOMContainer=e,this.mDOMContainer.addEventListener("mouseover",this.onMouseOver)},e.prototype.updatePhysics=function(){this.mWorld.step(this.mPhysicsDeltaTime),this.mSceneObjects.syncAll(this.mCamera)},e.prototype.render=function(){this.mRenderer.render(this.mScene,this.mCamera)},e.prototype.resetSimulation=function(){this.mSceneObjects.resetPosition()},e.prototype.useAnimatedMarker=function(e){this.mMarker.use3DModel(e,this.mScene)},e}()}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o,s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();i=[n,t],void 0!==(o=function(e,t){"use strict";function n(e,t){t.style.left=(e.getBoundingClientRect().width+e.getBoundingClientRect().left-t.getBoundingClientRect().width).toString()+"px"}function i(e,t,n,i){e.style.top=t.toString()+"px";var o=window.innerHeight-t-n;e.style.height=o.toString()+"px",i&&i()}function o(e,t,n){function i(){s+=1/60;var t=s/r,h=a[n](t);t<1?(requestAnimationFrame(i),window.scrollTo(0,o+(e-o)*h)):(console.log("scroll done"),window.scrollTo(0,e))}void 0===e&&(e=0),void 0===t&&(t=2e3),void 0===n&&(n="easeOutSine");var o=window.scrollY||document.documentElement.scrollTop,s=0,r=Math.max(.1,Math.min(Math.abs(o-e)/t,.8)),a={easeOutSine:function(e){return Math.sin(e*(Math.PI/2))},easeInOutSine:function(e){return-.5*(Math.cos(Math.PI*e)-1)},easeInOutQuint:function(e){return(e/=.5)<1?.5*Math.pow(e,5):.5*(Math.pow(e-2,5)+2)}};i()}function r(e){var t=e.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,s=window.pageXOffset||i.scrollLeft||n.scrollLeft,r=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,h=t.top+o-r,c=t.left+s-a;return{top:Math.round(h),left:Math.round(c)}}t.__esModule=!0,t.alignOnRight=n,t.resize=i;var a=function(){function e(t){this.type=e.typeID,this.rank=t}return e}();a.typeID="scrolledToVisible",t.EventScrolledToVisible=a;var h=function(){function e(){this.type=e.typeID}return e}();h.typeID="scrolledToHidden",t.EventScrolledToHidden=h;var c=function(e){function t(t){var n=e.call(this)||this;return n.mPreviousFound=-1,n.mPreviousFound=-1,n.mIsVisible=!1,n.mSections=t.map(function(e){var t=document.getElementById(e);return t||console.error("cannot find HTMLElement by id :'"+e+"'"),t}),n}return s(t,e),t.prototype.fetchAt=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0);var i=this.mSections.length,o=this.mSections.map(function(e){return e.getBoundingClientRect()});if(o[0].top>e+t)this.mIsVisible&&this.hide();else if(o[i-1].top<n)this.mIsVisible&&this.hide();else{this.mIsVisible=!0;for(var s=Number.MAX_VALUE,r=0,h=0;h<i;h++){var c=o[h].top+o[h].height/2;c>0&&c<s&&(r=h,s=c)}this.mPreviousFound!=r&&(this.dispatchEvent(new a(r)),this.mPreviousFound=r)}},t.prototype.hide=function(){this.mPreviousFound=-1,this.dispatchEvent(new h),this.mIsVisible=!1},t}(THREE.EventDispatcher);t.ScrollerSpy=c,t.smoothScrollTop=o,t.getBoundingAbsoluteLeftTopCorner=r}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o;i=[n,t,n(3),n(1),n(4),n(0)],void 0!==(o=function(e,t,n,i,o,s){"use strict";t.__esModule=!0;var r=document.getElementById("portalinput");if(Detector.webgl){r.classList.remove("hidden"),s.assetPath="dropped/assets";var a=document.getElementById("mainNav"),h=["web","dmu","optimization","researchdevelopment"],c=new n("portalinput"),l=["cube","a380","wrench","bulb"];c.addPortal(!1,!1),c.enablePhysics=!1,c.useAnimatedMarker(!0),c.animate();var m=document.getElementById("portaloutputcanvas"),u=new n("portaloutput",m);u.addPortal(!0,!0),u.enablePhysics=!1,u.useAnimatedMarker(!0),u.animate();var d=350;a&&(d=a.getBoundingClientRect().height+20);var p=!1,f=new o.ScrollerSpy(["portalinput"]);f.addEventListener(o.EventScrolledToVisible.typeID,function(e){p||(c.enablePhysics=!1,c.clear(),c.addLoadedModels(l),c.enablePhysics=!0,p=!0)});var v=new o.ScrollerSpy(h.concat(["about"]));v.addEventListener(o.EventScrolledToVisible.typeID,function(e){if(console.log("=> showing #"+e.rank),e.rank<y.length){y[e.rank].appendChild(m),u.updateDOMContainer(y[e.rank]);var t=[l[e.rank]];u.enablePhysics=!1,u.clear(),u.addLoadedModels(t),u.enablePhysics=!0}});var M=window.innerHeight-0,w=a.getBoundingClientRect().height+(window.innerHeight-r.getBoundingClientRect().height)/2+400;f.fetchAt(w),window.addEventListener("scroll",function(e){window.requestAnimationFrame(function(){var e=a.getBoundingClientRect().height+(window.innerHeight-r.getBoundingClientRect().height)/2+400;f.fetchAt(e),v.fetchAt(d,-0,M)})});var y=h.map(function(e){var t=document.getElementById(e);if(t){var n=t.getElementsByClassName("portal-right");if(n.length>0)return n.item(0);console.error("cannot find canvas container for id : "+e)}return null}),E=new o.ScrollerSpy(h);E.addEventListener(o.EventScrolledToVisible.typeID,function(e){console.log("=> showing #"+e.rank),y[e.rank].appendChild(m);var t=[l[e.rank]];u.enablePhysics=!1,u.clear(),u.addLoadedModels(t),u.enablePhysics=!0,u.onWindowResize()}),E.addEventListener(o.EventScrolledToHidden.typeID,function(e){u.onWindowResize()});var g=h.map(function(e){return document.getElementById(e)});c.getSceneObjects().addEventListener(i.EventTeleported.typeID,function(e){var t=e.objectName,n=g.map(function(e){return o.getBoundingAbsoluteLeftTopCorner(e).top}),i=l.indexOf(t),s=n[i]-(window.innerHeight-g[i].getBoundingClientRect().height-1.1*a.getBoundingClientRect().height)/2-100;o.smoothScrollTop(s,5),console.log(n),console.log("scrollTo:"+n[i]);var r=[t];u.enablePhysics=!1,u.clear(),u.addLoadedModels(r),u.enablePhysics=!0})}else{for(var C=document.getElementsByClassName("portal-right"),T=0;T<C.length;T++){var S=C[T];S.style.display="none"}for(var P=document.getElementsByClassName("col-sm-12 col-md-9");P.length>0;){var S=P[0];S.className="col-sm-12 col-md-12"}}}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o;i=[n,t],void 0!==(o=function(e,t){"use strict";function n(e){return new Promise(function(t,n){(new THREE.JSONLoader).load(e,function(e,i){if(e||n("Mesh empty"),e.animations){var o=void 0;i?i.forEach(function(e){e.skinning=!0}):o=new THREE.MeshPhongMaterial({color:8947848,skinning:!0});var s=new THREE.SkinnedMesh(e,o);s.castShadow=!0;var r=new THREE.AnimationMixer(s),a=r.clipAction(e.animations[0]);a.setEffectiveWeight(1),a.setLoop(THREE.LoopRepeat,10),a.clampWhenFinished=!1,a.enabled=!0,a.play(),t(s)}else{var o=void 0;i||(o=new THREE.MeshPhongMaterial({color:8947848}));var s=new THREE.Mesh(e,o);t(s)}},function(e){},function(e){n(e.error)})})}t.__esModule=!0,t.loadModel=n}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o;i=[n,t],void 0!==(o=function(e,t){"use strict";return function(){function e(e){this.mWorld=e;var t=new CANNON.Sphere(.1);this.mJointBody=new CANNON.Body({mass:0}),this.mJointBody.addShape(t),this.mJointBody.collisionFilterGroup=0,this.mJointBody.collisionFilterMask=0,this.mWorld.addBody(this.mJointBody)}return e.prototype.hasMouseConstraint=function(){return void 0!==this.mPointConstraint},e.prototype.add=function(e,t){this.mConstrainedBody=t;var n=new CANNON.Vec3(e.x,e.y,e.z).vsub(this.mConstrainedBody.position),i=this.mConstrainedBody.quaternion.inverse(),o=i.vmult(n);this.mJointBody.position.set(e.x,e.y,e.z),this.mPointConstraint=new CANNON.PointToPointConstraint(this.mConstrainedBody,o,this.mJointBody,new CANNON.Vec3(0,0,0)),this.mWorld.addConstraint(this.mPointConstraint)},e.prototype.move=function(e){this.mPointConstraint&&(this.mJointBody.position.set(e.x,e.y,e.z),this.mPointConstraint.update())},e.prototype.remove=function(){this.mWorld.removeConstraint(this.mPointConstraint),this.mPointConstraint=void 0},e}()}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o;i=[n,t,n(9),n(7)],void 0!==(o=function(e,t,n,i){"use strict";return function(){function e(e,t,o,s){this.mClosestDistance=-1,this.mConstraintDown=!1,this.mView=new n.MarkerView(e),this.mJointConstraint=new i(o),this.mCamera=t,this.mRaycaster=new THREE.Raycaster,this.mSceneObjects=s}return e.prototype.projectOntoPlane=function(e,t,n){var i=new THREE.Vector3(2*e.x-1,2*-e.y+1,.5);i.unproject(t);var o=i.sub(t.position).normalize(),s=t.position.clone();return s.add(o.multiplyScalar(n)),s},e.prototype.hover=function(e){var t=this.findNearestIntersectingObject(e,this.mCamera,this.mSceneObjects.mMeshes);if(t){var i=t.distance,o=this.projectOntoPlane(e,this.mCamera,i);this.mView.setState(n.State.hover),this.mView.updateMeshPosition(o)}else{var i=1.5*this.mCamera.getWorldPosition().distanceTo(new THREE.Vector3(0,0,0)),o=this.projectOntoPlane(e,this.mCamera,i);this.mView.setState(n.State.move),this.mView.updateMeshPosition(o)}},e.prototype.move=function(e,t){if(this.mJointConstraint.hasMouseConstraint()){var i=this.projectOntoPlane(e,this.mCamera,this.mClosestDistance);i&&(this.mView.setState(n.State.pick),this.mView.updateMeshPosition(i),this.mJointConstraint.move(i))}else t?this.hover(e):this.mView.setState(n.State.hide)},e.prototype.findNearestIntersectingObject=function(e,t,n){var i=new THREE.Vector2;i.x=2*e.x-1,i.y=2*-e.y+1,this.mRaycaster.setFromCamera(i,t);var o=this.mRaycaster.intersectObjects(n),s=void 0;return o.length>0&&(s=o[0]),s},e.prototype.put=function(e){var t=this.findNearestIntersectingObject(e,this.mCamera,this.mSceneObjects.mMeshes);if(t&&t.object instanceof THREE.Mesh){var i=t.point;if(i&&"ground"!==t.object.name){this.mClosestDistance=t.distance,this.mConstraintDown=!0,this.mView.setState(n.State.pick),this.mView.updateMeshPosition(i);var o=this.mSceneObjects.mMeshes.indexOf(t.object);-1!==o&&this.mJointConstraint.add(i,this.mSceneObjects.mBodies[o])}}},e.prototype.remove=function(e,t){this.mConstraintDown=!1,t?this.hover(e):this.mView.setState(n.State.hide),this.mJointConstraint.remove()},e.prototype.use3DModel=function(e,t){this.mView.use3DModel(e,t)},e}()}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o;i=[n,t,n(0),n(6)],void 0!==(o=function(e,t,n,i){"use strict";t.__esModule=!0;var o;!function(e){e[e.move=0]="move",e[e.pick=1]="pick",e[e.hover=2]="hover",e[e.hide=3]="hide",e[e.undef=4]="undef"}(o=t.State||(t.State={}));var s=function(){function e(e){var t=new THREE.MeshLambertMaterial({color:16711680}),n=new THREE.SphereGeometry(.2,8,8);this.mDefaultMesh=new THREE.Mesh(n,t),this.mDefaultMesh.castShadow=!0,this.mCurrentMesh=this.mDefaultMesh,this.mUseDefaultMesh=!0,this.mState=o.undef,e.add(this.mDefaultMesh),this.setState(o.hide)}return e.prototype.updateMesh=function(e,t){e&&e.position.copy(t)},e.prototype.setState=function(e){if(this.mState!==e)switch(this.mState=e,this.mState){case o.pick:this.mUseDefaultMesh?this.setVisibleMesh(this.mDefaultMesh,!0):this.setCurrentMesh(!0);break;case o.hover:this.mUseDefaultMesh||(this.setCurrentMesh(!1),this.setColor(this.mCurrentMesh,34816));break;case o.move:this.mUseDefaultMesh||(this.setCurrentMesh(!1),this.setColor(this.mCurrentMesh,8912896));break;case o.hide:default:this.mUseDefaultMesh?this.setVisibleMesh(this.mDefaultMesh,!1):(this.setVisibleMesh(this.mPickingMesh,!1),this.setVisibleMesh(this.mMovingMesh,!1))}},e.prototype.setCurrentMesh=function(e){e?(this.mCurrentMesh=this.mPickingMesh,this.setVisibleMesh(this.mPickingMesh,!0),this.setVisibleMesh(this.mMovingMesh,!1)):(this.mCurrentMesh=this.mMovingMesh,this.setVisibleMesh(this.mPickingMesh,!1),this.setVisibleMesh(this.mMovingMesh,!0))},e.prototype.updateMeshPosition=function(e){this.mUseDefaultMesh?this.updateMesh(this.mDefaultMesh,e):this.updateMesh(this.mCurrentMesh,e)},e.prototype.setVisibleMesh=function(e,t){e&&(e.visible=t)},e.prototype.setColor=function(e,t){if(e&&e.material){e.material.color.setHex(t)}},e.prototype.use3DModel=function(e,t){function o(e,t){e.scale.set(5,5,5),e.material.color=new THREE.Color(t),e.material.transparent=!0,e.material.opacity=.5,e.material.depthTest=!1}var s=this;if(this.mUseDefaultMesh=!e,e){if(this.mDefaultMesh.visible=!1,!this.mMovingMesh){var r=i.loadModel(n.assetPath+"/handGrab.json");r.then(function(e){var n=e;if(!e)return void console.log("Cannot read animated 3D marker model! ");o(n,34816);var i=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),.85*-Math.PI);n.quaternion.set(i.x,i.y,i.z,i.w),n.quaternion.multiply((new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),.25*-Math.PI)),n.quaternion.multiply((new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,0,1),.5)),s.mMovingMesh=n,s.mMovingMesh.visible=!1,t.add(n)}).catch(function(e){console.log(e)})}if(!this.mPickingMesh){var r=i.loadModel(n.assetPath+"/handPick.json");r.then(function(e){var n=e;if(!e)return void console.log("Cannot read animated 3D marker model! ");o(n,34816);var i=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),.5*-Math.PI);n.quaternion.set(i.x,i.y,i.z,i.w),n.quaternion.multiply((new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),.25*-Math.PI)),n.quaternion.multiply((new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,0,1),-.5)),s.mPickingMesh=n,s.mPickingMesh.visible=!1,t.add(n)}).catch(function(e){console.log(e)})}}},e}();t.MarkerView=s}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o;i=[n,t,n(2)],void 0!==(o=function(e,t,n){"use strict";return function(){function e(e,t,n){this.mScene=e,this.mWorld=t,this.mSceneObjects=n}return e.prototype.load=function(e,t){var i=this,o=n.loadModel(e+"/"+t+".json"),s=n.loadModel(e+"/"+t+".hull.json");Promise.all([o,s]).then(function(e){var n=e[0];e[0]&&e[1]||console.log("Cannot read model or hull properly! "),n.name=t,i.mScene.add(n);var o=e[1],s=o.geometry,r=s.vertices.map(function(e){return new CANNON.Vec3(e.x,e.y,e.z)}),a=s.faces.map(function(e){return[e.a,e.b,e.c]}),h=new CANNON.ConvexPolyhedron(r,a),c=new CANNON.Body({mass:1});c.addShape(h),i.mWorld.addBody(c),i.mSceneObjects.push(n,c)}).catch(function(e){console.log(e)})},e}()}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o;i=[n,t,n(0),n(2)],void 0!==(o=function(e,t,n,i){"use strict";return function(){function e(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this.mTopCentered=e,this.mIsOutput=t}return e.prototype.moveToWindowPlane=function(e){if(this.mMeshes){var t=new THREE.Vector2(1.005,.5),n=Math.PI/2;this.mTopCentered&&(t=new THREE.Vector2(.5,-.005),n=Math.PI);var i=new THREE.Vector3(2*t.x-1,2*-t.y+1,.5);e.updateMatrix(),e.updateMatrixWorld(!0),i=i.unproject(e);var o=i.sub(e.position).normalize(),s=Math.atan(o.z/o.x);this.mTopCentered&&(s=-Math.atan(o.y/o.x));var r=e.position.clone();r.add(o.multiplyScalar(15)),this.mMeshes[0].position.set(r.x,r.y,r.z);var a=new THREE.Quaternion;a.setFromAxisAngle(new THREE.Vector3(1,0,0),n),this.mMeshes[0].quaternion.set(a.x,a.y,a.z,a.w),this.mMeshes[0].quaternion.multiply((new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,0,1),s)),this.mMeshes[1].position.set(r.x,r.y,r.z),this.mMeshes[1].quaternion.set(a.x,a.y,a.z,a.w),this.mMeshes[1].quaternion.multiply((new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,0,1),s)),this.mMeshes[1].quaternion.multiply((new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2))}},e.prototype.load=function(e,t){var o=this;i.loadModel(n.assetPath+"/portal.json").then(function(n){var i=n;if(!n)return void console.log("Cannot read portal model! ");i.scale.set(.5,.8,.5);var s=[6411261,8118514];o.mIsOutput&&(s=[15380565,16757565]),i.material=new THREE.MeshPhongMaterial({color:s[0]}),i.material.transparent=!0,i.material.depthTest=!1,i.material.depthWrite=!1,i.castShadow=!1,i.material.opacity=.5,e.add(i);var r=i.clone();r.scale.set(.4,.7,.4),r.material=new THREE.MeshPhongMaterial({color:s[1]}),r.material.transparent=!0,r.material.depthTest=!1,r.material.opacity=.5,r.castShadow=!1,e.add(r),o.mMeshes=[i,r],t()}).catch(function(e){console.log(e)})},e.prototype.updateAnimation=function(){if(this.mMeshes){this.mMeshes[0].quaternion.multiply((new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),.005)),this.mMeshes[1].quaternion.multiply((new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),-.015))}},e}()}.apply(t,i))&&(e.exports=o)},function(e,t,n){var i,o,s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();i=[n,t,n(1)],void 0!==(o=function(e,t,n){"use strict";var i;!function(){function e(){this.mass=1,this.startHeight=5,this.objectHeight=1}}();return function(e){e[e.nominal=0]="nominal",e[e.outOfBounds=1]="outOfBounds",e[e.teleported=2]="teleported"}(i||(i={})),function(e){function t(t){var n=e.call(this)||this;return n.mMeshes=[],n.mBodies=[],n.mStates=[],n.mMeshes=[],n.mBodies=[],n.mStates=[],n.mPhysicsStartParameters=t,n}return s(t,e),t.prototype.push=function(e,t){var n=new THREE.Vector3(0,this.mPhysicsStartParameters.startHeight+this.mPhysicsStartParameters.objectHeight*this.mMeshes.length,0);e.position.set(n.x,n.y,n.z),t.mass=this.mPhysicsStartParameters.mass,t.position.set(n.x,n.y,n.z),this.mMeshes.push(e),this.mBodies.push(t),this.mStates.push(i.nominal)},t.prototype.resetBody=function(e){e.position.setZero(),e.previousPosition.setZero(),e.interpolatedPosition.setZero(),e.initPosition.setZero(),e.quaternion.set(0,0,0,1),e.initQuaternion.set(0,0,0,1),e.interpolatedQuaternion.set(0,0,0,1),e.velocity.setZero(),e.initVelocity.setZero(),e.angularVelocity.setZero(),e.initAngularVelocity.setZero(),e.force.setZero(),e.torque.setZero(),e.sleepState=0,e.timeLastSleepy=0},t.prototype.resetPosition=function(){for(var e=0;e!==this.mMeshes.length;e++){var t=new THREE.Vector3(0,this.mPhysicsStartParameters.startHeight+this.mPhysicsStartParameters.objectHeight*e,0);this.resetBody(this.mBodies[e]),this.mMeshes[e].position.set(t.x,t.y,t.z),this.mBodies[e].position.set(t.x,t.y,t.z),this.mBodies[e].updateMassProperties(),this.mBodies[e].updateInertiaWorld(new CANNON.Vec3(0,0,0)),this.mBodies[e].updateSolveMassProperties(),this.mStates[e]=i.nominal}},t.prototype.sync=function(e,t){e.position.set(t.position.x,t.position.y,t.position.z),e.quaternion.set(t.quaternion.x,t.quaternion.y,t.quaternion.z,t.quaternion.w)},t.prototype.syncAll=function(e){if(!e)return void console.error("No camera");var t=new THREE.Frustum;t.setFromMatrix((new THREE.Matrix4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse));for(var o=0;o!==this.mMeshes.length;o++)this.sync(this.mMeshes[o],this.mBodies[o]);for(var o=0;o!==this.mMeshes.length;o++)if(this.mStates[o]===i.nominal||this.mStates[o]===i.outOfBounds){var s=this.mBodies[o].position;if(s.z<-5){console.log("Object #"+o+" '"+this.mMeshes[o].name+"' teleported!"),this.mStates[o]=i.teleported;var r=new n.EventTeleported(this.mMeshes[o].name);this.dispatchEvent(r)}else s.z>-5&&s.y<3&&!t.containsPoint(new THREE.Vector3(s.x,s.y,s.z))&&(console.log("Object #"+o+" '"+this.mMeshes[o].name+"' out of bounds!"),this.mStates[o]=i.outOfBounds)}if(this.mMeshes.length>0){for(var a=0,o=0;o!==this.mMeshes.length;o++)this.mStates[o]!==i.outOfBounds&&this.mStates[o]!==i.teleported||a++;a===this.mMeshes.length&&(console.log("We are screwed"),this.dispatchEvent(new n.EventAllHidden))}},t}(THREE.EventDispatcher)}.apply(t,i))&&(e.exports=o)}]);